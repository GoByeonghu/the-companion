# the-companion

유저 이동경로 유사도 분석을 통한 매칭 서비스
Matching Service based on Trajectory Similarity Analysis 


## 프로젝트 소개

모바일단에서 유저의 이동패턴을 도출할수있는 정보를 지속적으로 수집하여 이를 바탕으로
유사한 이동패톤을 갖는 유저를 상호 매칭하는 위치기반 서비스이다.
<br>

## 개발 기간
* 23.03.05일 - 23.06.12일

### 개발 환경
- **Framework** : Android Studio
- **Database** : MySQL DB

## 연구 내용

#### 요약

스마트폰은 대중들의 일상 대부분을 함께하는 도구가 되었다. 이에 따라 mobile device들은 사용자의 일상 생활을 가리키는
지표가 될 수 있는 데이터들을 다수 저장한다. 본 연구에서는 모바일 디바이스를 이용하여 이러한 데이터를 수집하고 정제하고
가공하여 유의미한 information을 만들어 사용자에게 서비스의 형태로 제공되는 일련의 과정을 소개한다. 이를 바탕으로 스마트폰을
활용해 gps, wifi연결시간, 선형가속벡터값의 data를 수집하여 일상생활속 이동패턴을 파악하고 이를 통해 유사한 패턴을 보이는
user를 상호 매칭하는 서비스를 기획하고 설계한다.

#### 연구 배경

특히 LBS(Location Based Service)에
초점을 맞추어 연구를 진행한다. 대부분의 사람들은
출퇴근, 등하교 등 일상 속에서 다소 반복적인 이동패턴을
보인다. 이런 이동패턴을 나타낼 수 있는 data(gps,
wifi연결시간, 선형가속벡터)를 mobile device를 이용해
수집하고 가공한다. 이를 통해 중앙서버에서 사용자
이동패턴을 분석하여 유사한 이동패턴을 보이는 user를
상호 매칭하는 sevice를 설계한다. 이를 통해 data를
수집하여 정제하고 가공하여 유의미한 정보를 만들어
사용자에게 서비스의 형태로 제공되는 일련의 과정을
소개하고 제시한다.
 
#### 관련연구

1. Android& Android Studio 

  Mobile Device를 대상으로 하는 linux kernel기반 운영체제이다.
  application 실행시 VM(virtue 
  machine)인 Android RunTime을 통해 별도의
  process에서 수행하도록 한다는 특징이있다

2. GPS

GPS(Global Positioning System)는 위성을 통해
위치(Positioning) 및 항법(Navigation), 시각(Timing) 
정보(PNT)를 제공해주는 위성 항법시스템이다.

3. 선형가속 센서 

hardware 기반 센서와 이를 바탕으로 가공한
데이터인 software기반의 센서가 있다. 본 연구에서는
흔들림을 감지하기 위해 중력 값을 제거하고 순수하게
기기에 가해진 가속도만 측정하는 software기반의
선형가속 센서를 이용한다.

#### 데이터 처리

1. 데이터 수집 
- GPS좌표(위도,경도) : 시간𝑡 경과마다 수집.
- 선형가속벡터(x,y,z) : 시간𝑡 경과마다 수집.
- wifi접속 여부 : 시간𝑡 경과시마다 수집. 혹은 wifi 연결, 해제 이벤트 발생시에 수집.

2. 데이터 정제 
- GPS좌표(위도,경도) 

① location filter : gps는 일정정도의 오류를 내포하며
실내에서는 오류의 정도가 커짐으로 이를 wifi 연결로
인해 확인되는 위치 정보 등으로 보정한다. sensor 
detect와 동시에 이루어져야 한다.

② vector filter : 수집된 data를 시간을 기준으로
정렬하면 인접한 index사이에 gps좌표간 euclidean 
distance를 구할 수 있고 이를 해당 index사이의 시간
차로 나누어 속도를 구한다. 해당 속도가 지나치게 큰
값이라면 해당 data를 error로 간주하여 삭제한다.[5]

- 선형가속벡터(x,y,z)

① absolute filter : 가속도의 값이 지나치게 큰 값으로
측정된 data는 오류로 간주하여 인접한 시간의 vector의
산술평균으로 값을 바꾼다.
이렇게 정제된 data는 이동경로라는 정보로 도출되고자
다음 단계로 넘어간다

3. 데이터 조합

이동경로 data는 일종의 graph로
구성된다. vertex는 상태(정지 혹은 이동)와
머문시간(도달시간, 출발시간)으로 구성된다. edge는
이동수단이 저장된다. 해당 data를 도출하는 방법은
아래와 같다.
① 시간으로 정렬했을 때 인접한 gps간의 (거리/시간)으로
도출한 속도가 일정 값 STOP_DECISION 이하인 연속한
data들을 합쳐서 하나의 vertex를 구성한다. 상태는
정지로 판단된다. 합쳐진 data들의 시간 값의 배열을
𝑇 라고 했을 때 도달시간은 min(T)로 출발시간은
max(T)로 구성된다.[6] wifi연결이 True인 data도 정지로
판단한다.

② 인접한 data간 속도가 STOP_DECISION이상인 data는
이전의 data와 합쳐지지 않고 독립적으로 구성되어
상태는 이동중으로 저장된다.

③ 위의 ①, ②과정이 끝난 vertex간의 가속벡터(흔들림), 
속도에 따라 decision value를 두어 도보인지 자동차인지
지하철인지 판단하여 edge에 이동수단을 저장한다.
위의 방식으로 도출된 이동경로 data는 전체 데이터가
연결되어 있다. 그러므로 유사한 위치 값을 갖는 정지상태
vertex를 기준으로 회귀주기가 반복됨을 판단한다면 해당
주기 별로 데이터를 자르거나 혹은 24시간을 기준으로
자를 수 있다

4. 패턴 파악

user마다 이동경로 data가 복수 개 저장 되어있다. 
일반적으로 요일마다 이동패턴이 반복됨으로 요일 별로
이동경로 data를 분류한다. 가장 빠른 시간의
정지vertex를 출발지로 가장 느린시간의 정지vertex를
도착지로 판단한다. 요일별 이동경로 데이터들에 대해
정지부터 도착까지 vertex간의 좌표의 평균을 구해
요일마다 하나의 대표 이동경로 패턴을 도출한다

5. 의미 있는 정보 추출

대표이동경로(패턴)을 바탕으로 상호간에 유사도를 측정한다. 
유사도 측정 방식은 rank를계산하는 것이다. 출발, 도착지의 
거리가 가까운지, 이동시간이 유사한지, 이동수단이 같은지에
대해 각각 점수를 배정해 해당 점수에 따라 가장 큰 유사도를 
갖는 user를 찾는다

#### 참고자료

[1]https://developer.android.com/guide/platform

[2] https://developer.android.com/studio/intro

[3]한진희, “GPS 수신기 설계 기술 및 동향”,2007

[4]https://developer.android.com/guide/topics/sensors/

[5] 양승국, 백혜정, 김제민, 전명중, 박영택 “개인 경로
학습을 위한 GPS 좌표 기반 이동 궤적 추출”, 2011

[6]김선용, 박범준, 정재진 “모바일장치의 GPS를 이용한
사용자 이동경로 분석 및 이동경로 추천 시스템”, 2011.2

[7] 양혜진 “모바일의 위치데이터를 활용한 사용자 조사
방법”, 2015.5
